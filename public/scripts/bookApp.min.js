function CurrentUserObject(){this.currentUserId=null,this.currentUserName=null,this.currentUserBooks=[],this.sortBooksByStack=function(a){for(var b=this.currentUserBooks,c=0;c<b.length;c++)"current-read"===b[c].stack&&(b[c].sortNumber=1),"future-read"===b[c].stack&&(b[c].sortNumber=2),"recent-read"===b[c].stack&&(b[c].sortNumber=3),"archived"===b[c].stack&&(b[c].sortNumber=4);var d=_.sortBy(a,function(a){return a.sortNumber});this.currentUserBooks=d},this.filterByStack=function(a,b){var c=_.filter(a,function(a){return a.stack===b});return c},this.currentStackList=this.filterByStack(this.currentUserBooks,"current-read"),this.recentStackList=this.filterByStack(this.currentUserBooks,"recent-read"),this.futureStackList=this.filterByStack(this.currentUserBooks,"future-read")}function BooksObject(a){this.getAllUserBooks=function(b,c){a.post("/books/getall",{id:b}).success(function(a){c(null,a)}).error(function(a){c(a,{})})},this.getUserBook=function(b,c,d){a.get("/books/getbook").success(function(a){d(null,a)}).error(function(a){d(a,{})})},this.addBook=function(b,c){a.post("/books/addbook",{title:b.title,author:b.author,stack:b.stack,color:b.color}).success(function(a){c&&c(null,a)}).error(function(){})},this.updateBook=function(b,c,d,e){a.post("/books/updatebook",{title:b,updateKey:c,updateValue:d}).success(function(a,b){e&&e(null,a)}).error(function(a,b){e&&e(a,b)})},this.deleteBook=function(b,c){a.post("/books/deletebook",{title:b}).success(function(a,b){c&&c(a,b)}).error(function(a,b){c&&c(a,b)})},this.setBookColor=function(){var a=_.random(1,4);switch(a){case 1:a="red";break;case 2:a="blue";break;case 3:a="green";break;case 4:a="black";break;default:a="black"}return a}}function PostObject(a){this.allPosts=[],this.getPosts=function(b,c){a.post("/posts/getposts",{author:b}).success(function(a){c(null,a)}).error(function(){})},this.addPost=function(b,c){a.post("/posts/addpost",{newPost:b}).success(function(a){c(null,a)}).error(function(){})},this.addReply=function(b,c){a.post("/posts/addreply",{newReply:b}).success(function(a){c(null,a)}).error(function(){})}}function DragDropObject(a,b){this.makeDroppable=function(a){$(a).droppable({tolerance:"touch"})},this.makeDraggable=function(a){$(a).draggable({revert:"invalid",cursor:"move",contain:"window"})},this.updatesOnDrop=function(c,d,e){var f=$(d.draggable[0]),g="",h=e,i="",j="stack",k="";if("recent-stack"===h?(h="recentStackList",i="recent-read"):"current-stack"===h?(h="currentStackList",i="current-read"):"future-stack"===h?(h="futureStackList",i="future-read"):""===i&&(i=e),f.hasClass(h))return void $("body").css("cursor","auto");if(f.hasClass("recentStackList")&&(g="recentStackList"),f.hasClass("currentStackList")&&(g="currentStackList"),f.hasClass("futureStackList")&&(g="futureStackList"),f.hasClass("vertical-book")&&(k=f.find("p").text()),f.hasClass("horizontal-book")&&(k=f.text()),k=k.trim(),"trash"===i){f.effect("explode","slow",function(){f.remove()});for(var l=null,m=0;m<a[g].length;m++)if(a[g][m].title===k){l=m;break}for(var n=(a[g].splice(l,1),null),o=0;o<a.currentUserBooks.length;o++)if(a.currentUserBooks[m].title===k){n=o;break}{a.currentUserBooks.splice(n,1)}b.deleteBook(k),$("body").css("cursor","auto");var p=this;return void setTimeout(function(){p.makeDraggable(".book")},200)}b.updateBook(k,j,i);for(var m=0;m<a.currentUserBooks.length;m++)if(a.currentUserBooks[m].title===k){a.currentUserBooks[m].stack=i;break}a.sortBooksByStack(a.currentUserBooks);for(var l=0,m=0;m<a[g].length;m++)if(a[g][m].title===k){l=m,a[g][m].stack=i;break}var q=a[g].splice(l,1);if("archived"===i){f.effect("fade","slow",function(){f.remove()}),$("body").css("cursor","auto");var p=this;return void setTimeout(function(){p.makeDraggable(".book")},200)}a[h].push(q[0]),f.remove(),$("body").css("cursor","auto");var p=this;setTimeout(function(){p.makeDraggable(".book")},200)}}var bookApp=angular.module("bookApp",["ngRoute","ui.bootstrap","ngAnimate","ngSanitize"]);bookApp.service("currentUserServices",["$http",CurrentUserObject]),bookApp.service("bookServices",["$http",BooksObject]),bookApp.service("postServices",["$http","currentUserServices",PostObject]),bookApp.service("dragDropServices",["currentUserServices","bookServices",DragDropObject]),bookApp.controller("CurrentUserController",["$scope","bookServices","currentUserServices","dragDropServices",function(a,b,c){a.currentUser="",a.init=function(){a.currentUser=currentUser._id,c.currentUserId=currentUser._id,c.currentUserName=currentUser.userName,c.currentUserBooks=currentUser.books,c.sortBooksByStack(currentUser.books)},a.init()}]),bookApp.controller("OpenModal",["$scope","$modal","$log",function(a,b){a.open=function(c){b.open({templateUrl:"/partials/"+c,scope:a})}}]),bookApp.controller("SigninController",["$scope",function(a){a.bookLover={},a.bookLover.email="",a.bookLover.password=""}]),bookApp.controller("SignupController",["$scope",function(a){a.newBookLover={},a.newBookLover.userName="",a.newBookLover.email="",a.newBookLover.password="",a.newBookLover.confirmPassword=""}]),bookApp.directive("inputMatch",[function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=function(){var b=a.$eval(c.ngModel),d=a.$eval(c.inputMatch);return b===d};a.$watch(e,function(a){d.$setValidity("isMatch",a)})}}}]),bookApp.directive("uniqueUsername",["$http",function(a){return{require:"ngModel",link:function(b,c,d,e){c.bind("blur",function(){var b=c.val();e.$setValidity("isTaken",!0),e.$setValidity("invalidChars",!0),b&&($(".glyphicon-refresh").removeClass("is-none"),a.post("/signup/check/username",{userName:b}).success(function(){$(".glyphicon-refresh").addClass("is-none")}).error(function(a){a.isTaken?e.$setValidity("isTaken",!1):a.invalidChars&&e.$setValidity("invalidChars",!1),$(".glyphicon-refresh").addClass("is-none")}))})}}}]),bookApp.controller("ShowAddBookController",["$scope",function(a){a.formStatus={formOpen:!1,showForm:function(){a.formStatus.formOpen=!0}}}]),bookApp.controller("AddBookController",["$scope","bookServices","currentUserServices","dragDropServices",function(a,b,c,d){a.book={},a.book.title=null,a.book.author=null,a.book.stack=null,a.book.color=null,a.submit=function(e){e.preventDefault(),a.book.title&&a.book.stack&&(a.book.color=b.setBookColor(),b.addBook(a.book,function(b,e){var f=e.stack,g="";"current-read"===f&&(g="currentStackList"),"recent-read"===f&&(g="recentStackList"),"future-read"===f&&(g="futureStackList"),c.currentUserBooks.push(e),c.sortBooksByStack(c.currentUserBooks),c[g].push(e),setTimeout(function(){d.makeDraggable(".book")},200),a.formStatus.formOpen=!1,a.book={},a.book.title=null,a.book.author=null,a.book.stack=null}))},a.cancel=function(b){b.preventDefault(),a.formStatus.formOpen=!1,a.book={},a.book.title=null,a.book.author=null,a.book.stack=null}}]),bookApp.controller("LibraryController",["$scope","currentUserServices",function(a,b){a.library={},a.library.booksList=b.currentUserBooks,a.library.userName=b.currentUserName}]),bookApp.controller("RecentStackController",["$scope","currentUserServices","dragDropServices","bookServices",function(a,b,c){a.recentStack={},a.recentStack.booksList=b.recentStackList,a.$watch("currentUserServices.currentUserBooks",function(){b.recentStackList=b.filterByStack(b.currentUserBooks,"recent-read"),a.recentStack.booksList=b.recentStackList}),c.makeDroppable("#recent-stack"),$(document).on("drop","#recent-stack",function(a,b){var d=this.id;c.updatesOnDrop(a,b,d)})}]),bookApp.controller("CurrentStackController",["$scope","currentUserServices","dragDropServices","bookServices",function(a,b,c){a.currentStack={},a.currentStack.booksList=b.currentStackList,a.$watch("currentUserServices.currentUserBooks",function(){b.currentStackList=b.filterByStack(b.currentUserBooks,"current-read"),a.currentStack.booksList=b.currentStackList}),c.makeDroppable("#current-stack"),$(document).on("drop","#current-stack",function(a,b){var d=this.id;c.updatesOnDrop(a,b,d)})}]),bookApp.controller("FutureStackController",["$scope","currentUserServices","dragDropServices","bookServices",function(a,b,c){a.futureStack={},a.futureStack.booksList=b.futureStackList,a.$watch("currentUserServices.currentUserBooks",function(){b.futureStackList=b.filterByStack(b.currentUserBooks,"future-read"),a.futureStack.booksList=b.futureStackList,setTimeout(function(){c.makeDraggable(".book")},200)}),c.makeDroppable("#future-stack"),c.makeDroppable(".trash-can"),c.makeDroppable(".archive-square"),$(document).on("drop","#future-stack",function(a,b){var d=this.id;c.updatesOnDrop(a,b,d)})}]),bookApp.filter("reverse",function(){return function(a){return a.slice().reverse()}}),bookApp.controller("TrashController",["$scope","currentUserServices","bookServices","dragDropServices",function(a,b,c,d){$(document).on("drop",".trash-can",function(a,b){var c=this.id;d.updatesOnDrop(a,b,c)})}]),bookApp.controller("ArchiveController",["$scope","currentUserServices","bookServices","dragDropServices",function(a,b,c,d){$(document).on("drop",".archive-holder",function(a,b){var c=this.id;d.updatesOnDrop(a,b,c)})}]),bookApp.controller("NewPostController",["$scope","postServices","currentUserServices",function(a,b,c){a.post={},a.post.subject=null,a.post.body=null,a.post.reset=function(b){b.preventDefault(),a.post.subject=null,a.post.body=null},a.post.addPost=function(d){if(d.preventDefault(),a.post.subject&&a.post.body){var e={subject:a.post.subject,body:a.post.body,userName:c.currentUserName,author:c.currentUserId};b.addPost(e,function(a,c){b.allPosts.unshift(c)}),a.$close()}}}]),bookApp.controller("PostsDisplayController",["$scope","$http","postServices","currentUserServices",function(a,b,c,d){a.postsDisplay={},a.postsDisplay.allPosts=c.allPosts,a.postsDisplay.loadPosts=function(){c.getPosts(d.currentUserId,function(b,d){if(b)a.postsDisplay.allPosts=[];else{if(_.isEmpty(d))return;for(var e=0;e<d.length;e++)c.allPosts.push(d[e])}})},a.$watch("currentUserServices.currentUserName",function(){a.postsDisplay.loadPosts()})}]),bookApp.controller("NewReplyController",["$scope","$http","postServices","currentUserServices",function(a,b,c){a.newReply={},a.newReply.userName=null,a.newReply.body=null,a.newReply.reset=function(b){b.preventDefault(),a.newReply.userName=null,a.newReply.body=null},a.newReply.addReply=function(b){if(b.preventDefault(),a.newReply.userName&&a.newReply.body){var d={body:a.newReply.body,postId:a.post._id,replyUserName:a.newReply.userName,timestamp:new Date};c.addReply(d,function(a,b){var d,e=b._id,f=c.allPosts.length;for(d=0;f>d;d++)if(c.allPosts[d]._id===e){c.allPosts[d].replies.push(b.replies[b.replies.length-1]);break}}),a.$close()}}}]);
//# sourceMappingURL=bookApp.min.js.map